
> @userdashboard/stripe-connect@1.0.18 test2 /home/benlowry/SynologyDrive/workspaces/dashboard/stripe-connect
> mocha src --recursive --no-colors --full-trace --retries 3 --timeout 120000 --slow 120000



  server/bind-ip
    BindIP#BEFORE
      ✓ should prioritize ip from header
      ✓ should bind ip from connection remoteAddress
      ✓ should bind ip from connection socket
      ✓ should bind ip from socket remoteAddress

  server/bind-stripekey
    BindStripeKey#AFTER
      ✓ should bind stripekey data to req

  /account/connect/beneficial-owner
    BeneficialOwner#BEFORE
      ✓ should reject invalid ownerid
      ✓ should bind owner to req
    BeneficialOwner#GET
      ✓ should show table for owner

  /account/connect/beneficial-owners
    BeneficialOwners#BEFORE
      ✓ should reject invalid stripeid
      ✓ should reject individual registration
      ✓ should bind owners to req
    BeneficialOwners#GET
      ✓ should have row for each owner
      ✓ should display submitted message with removed owners

  /account/connect/company-director
    CompanyDirector#BEFORE
      ✓ should reject invalid directorid
      ✓ should bind director to req
    CompanyDirector#GET
      ✓ should show table for director

  /account/connect/company-directors
    CompanyDirectors#BEFORE
      ✓ should reject invalid stripeid
      ✓ should reject individual registration
      ✓ should bind directors to req
    CompanyDirectors#GET
      ✓ should have row for each director
      ✓ should display submitted message with removed directors

  /account/connect/create-beneficial-owner
    CreateBeneficialOwner#BEFORE
      ✓ should reject invalid stripeid
      ✓ should reject submitted registration
      ✓ should require own Stripe account
    CreateBeneficialOwner#GET
      ✓ should present the form
    CreateBeneficialOwner#POST
      ✓ should require each field
      ✓ should require a document id front upload
      ✓ should require a document id back upload
      ✓ should create beneficial owner

  /account/connect/create-company-director
    CreateCompanyDirector#BEFORE
      ✓ should reject invalid stripeid
      ✓ should reject submitted registration
      ✓ should require own Stripe account
    CreateCompanyDirector#GET
      ✓ should present the form
    CreateCompanyDirector#POST
      ✓ should require each field
      ✓ should require a document id front upload
      ✓ should require a document id back upload
      ✓ should create director

  /account/connect/create-registration
    CreateRegistration#GET
      ✓ should present the form
    CreateRegistration#POST
      ✓ should create Stripe account

  /account/connect/delete-beneficial-owner
    DeleteBeneficialOwner#BEFORE
      ✓ should reject invalid ownerid
      ✓ should reject submitted registration
      ✓ should require own Stripe account
      ✓ should bind owner to req
    DeleteBeneficialOwner#GET
      ✓ should present the form
      ✓ should present the owner table
    DeleteBeneficialOwner#POST
      ✓ should delete owner

  /account/connect/delete-company-director
    DeleteCompanyDirector#BEFORE
      ✓ should reject invalid directorid
      ✓ should reject submitted registration
      ✓ should require own Stripe account
      ✓ should bind director to req
    DeleteCompanyDirector#GET
      ✓ should present the form
      ✓ should present the director table
    DeleteCompanyDirector#POST
      ✓ should delete director

  /account/connect/delete-stripe-account
    DeleteStripeAccount#BEFORE
      ✓ should reject invalid stripeid
      ✓ should require own Stripe account
      ✓ should bind Stripe account to req
    DeleteStripeAccount#GET
      ✓ should present the form
      ✓ should present the Stripe account table
    DeleteStripeAccount#POST
      ✓ should delete Stripe account

  /account/connect/edit-beneficial-owner
    EditBeneficialOwner#BEFORE
      ✓ should reject invalid ownerid
      ✓ should reject submitted registration
      ✓ should require own Stripe account
      ✓ should bind owner to req
    EditBeneficialOwner#GET
      ✓ should present the form
    EditBeneficialOwner#POST
      ✓ should require each field
      ✓ should update owner
      ✓ should update document front upload
      ✓ should update document back upload

  /account/connect/edit-company-director
    EditCompanyDirector#BEFORE
      ✓ should reject invalid directorid
      ✓ should reject submitted registration
      ✓ should require own Stripe account
      ✓ should bind director to req
    EditCompanyDirector#GET
      ✓ should present the form
    EditCompanyDirector#POST
      ✓ should require each field
      ✓ should update director
      ✓ should update document front upload
      ✓ should update document back upload

  /account/connect/edit-company-registration
    EditCompanyRegistration#BEFORE
      ✓ should reject invalid registration
      ✓ should reject individual registration
      ✓ should reject invalid personal address country
      ✓ should reject invalid company address country
      ✓ should bind application CountrySpec to req
      ✓ should bind personal address country to req
      ✓ should bind posted personal address country to req
      ✓ should bind company address country to req
      ✓ should bind posted company address country to req
    EditCompanyRegistration#GET
      ✓ should present the form
      ✓ should have AT-required fields
      ✓ should have AU-required fields
      ✓ should have BE-required fields
      ✓ should have CA-required fields
      ✓ should have CH-required fields
      ✓ should have DE-required fields
      ✓ should have DK-required fields
      ✓ should have ES-required fields
      ✓ should have FI-required fields
      ✓ should have FR-required fields
      ✓ should have GB-required fields
      ✓ should have HK-required fields
      ✓ should have IE-required fields
      ✓ should have IT-required fields
      ✓ should have JP-required fields
      ✓ should have LU-required fields
      ✓ should have NL-required fields
      ✓ should have NO-required fields
      ✓ should have NZ-required fields
      ✓ should have PT-required fields
      ✓ should have SE-required fields
      ✓ should have SG-required fields
      ✓ should have US-required fields
    EditCompanyRegistration#POST
      ✓ should refresh and load states for posted company address
      ✓ should reject AT invalid fields
      ✓ should update AT information
      ✓ should reject AU invalid fields
      ✓ should update AU information
      ✓ should reject BE invalid fields
      ✓ should update BE information
      ✓ should reject CA invalid fields
      ✓ should update CA information
      ✓ should reject CH invalid fields
      ✓ should update CH information
      ✓ should reject DE invalid fields
      ✓ should update DE information
      ✓ should reject DK invalid fields
      ✓ should update DK information
      ✓ should reject ES invalid fields
      ✓ should update ES information
      ✓ should reject FI invalid fields
      ✓ should update FI information
      ✓ should reject FR invalid fields
      ✓ should update FR information
      ✓ should reject GB invalid fields
      ✓ should update GB information
      ✓ should reject HK invalid fields
      ✓ should update HK information
      ✓ should reject IE invalid fields
      ✓ should update IE information
      ✓ should reject IT invalid fields
      ✓ should update IT information
      ✓ should reject JP invalid fields (66973ms)
      ✓ should update JP information
      ✓ should reject LU invalid fields
      ✓ should update LU information
      ✓ should reject NL invalid fields
      ✓ should update NL information
      ✓ should reject NO invalid fields
      ✓ should update NO information
      ✓ should reject NZ invalid fields
      ✓ should update NZ information
      ✓ should reject PT invalid fields
      ✓ should update PT information
      ✓ should reject SE invalid fields
      ✓ should update SE information
      ✓ should reject SG invalid fields
      ✓ should update SG information
      ✓ should reject US invalid fields
      ✓ should update US information

  /account/connect/edit-individual-registration
    EditIndividualRegistration#BEFORE
      ✓ should reject invalid registration
      ✓ should reject company registration
      ✓ should bind application CountrySpec to req
      ✓ should bind address country to req
    EditIndividualRegistration#GET
      ✓ should present the form
      ✓ should have AT-required fields
      ✓ should have AU-required fields
      ✓ should have BE-required fields
      ✓ should have CA-required fields
      ✓ should have CH-required fields
      ✓ should have DE-required fields
      ✓ should have DK-required fields
      ✓ should have ES-required fields
      ✓ should have FI-required fields
      ✓ should have FR-required fields
      ✓ should have GB-required fields
      ✓ should have HK-required fields
      ✓ should have IE-required fields
      ✓ should have IT-required fields
      1) should have JP-required fields
      ✓ should have LU-required fields
      ✓ should have NL-required fields
      ✓ should have NO-required fields
      ✓ should have NZ-required fields
      ✓ should have PT-required fields
      ✓ should have SE-required fields
      ✓ should have SG-required fields
      ✓ should have US-required fields
    EditIndividualRegistration#POST
      ✓ should reject AT invalid fields
      ✓ should update AT information
      ✓ should reject AU invalid fields
      ✓ should update AU information
      ✓ should reject BE invalid fields
      ✓ should update BE information
      ✓ should reject CA invalid fields
      ✓ should update CA information
      ✓ should reject CH invalid fields
      ✓ should update CH information
      ✓ should reject DE invalid fields
      ✓ should update DE information
      ✓ should reject DK invalid fields
      ✓ should update DK information
      ✓ should reject ES invalid fields
      ✓ should update ES information
      ✓ should reject FI invalid fields
      ✓ should update FI information
      ✓ should reject FR invalid fields
      ✓ should update FR information
      ✓ should reject GB invalid fields
      ✓ should update GB information
      ✓ should reject HK invalid fields
      ✓ should update HK information
      ✓ should reject IE invalid fields
      ✓ should update IE information
      ✓ should reject IT invalid fields
      ✓ should update IT information
      ✓ should reject JP invalid fields
      ✓ should update JP information
      ✓ should reject LU invalid fields
      ✓ should update LU information
      ✓ should reject NL invalid fields
      ✓ should update NL information
      ✓ should reject NO invalid fields
      ✓ should update NO information
      ✓ should reject NZ invalid fields
      ✓ should update NZ information
      ✓ should reject PT invalid fields
      ✓ should update PT information
      ✓ should reject SE invalid fields
      ✓ should update SE information
      ✓ should reject SG invalid fields
      ✓ should update SG information
      2) should reject US invalid fields
      3) should update US information

  /account/connect/edit-payment-information
    EditPaymentInformation#BEFORE
      ✓ should reject invalid stripeid
      ✓ should bind Stripe account to req
    EditPaymentInformation#GET
      ✓ should present the form
    EditPaymentInformation#POST
      ✓ should reject AT invalid fields
      ✓ should submit AT information
      ✓ should reject AU invalid fields
      ✓ should update AU information
      ✓ should reject BE invalid fields
      ✓ should update BE information
      ✓ should reject CA invalid fields
      ✓ should update CA information
      ✓ should reject CH invalid fields
      ✓ should update CH information
      ✓ should reject DE invalid fields
      ✓ should update DE information
      ✓ should reject DK invalid fields
      ✓ should update DK information
      ✓ should reject ES invalid fields
      ✓ should update ES information
      ✓ should reject FI invalid fields
      ✓ should update FI information
      ✓ should reject GB invalid fields (account number, sort code)
      ✓ should update GB information (account number, sort code)
      ✓ should reject GB invalid fields (iban)
      ✓ should update GB information (iban)
      ✓ should reject HK invalid fields
      ✓ should update HK information
      ✓ should reject IE invalid fields
      ✓ should update IE information
      ✓ should reject IT invalid fields
      ✓ should update IT information
      ✓ should reject JP invalid fields
      ✓ should update JP information
      ✓ should reject LU invalid fields
      ✓ should update LU information
      ✓ should reject NL invalid fields
      ✓ should update NL information
      ✓ should reject NO invalid fields
      ✓ should update NO information
      ✓ should reject NZ invalid fields
      ✓ should update NZ information
      ✓ should reject PT invalid fields
      ✓ should update PT information
      ✓ should reject SE invalid fields
      ✓ should update SE information
      ✓ should reject SG invalid fields
      ✓ should update SG information
      ✓ should reject US invalid fields
      ✓ should update US information

  /account/connect
    Index#BEFORE
      ✓ should bind Stripe accounts to req
    Index#GET
      ✓ should have row for each Stripe account

  /account/connect/stripe-account
    StripeAccount#BEFORE
      ✓ should reject invalid stripeid
      ✓ should reject other account's stripeid
      ✓ should bind Stripe account to req
    StripeAccount#GET
      ✓ should show registration unstarted
      ✓ should show registration completed
      ✓ should hide registration after submitting registration
      ✓ should hide company owners after submitting registration
      ✓ should show payment information required
      ✓ should show payment information created
      ✓ should show ready to submit
      ✓ should show registration is submitted

  /account/connect/stripe-accounts
    StripeAccounts#BEFORE
      ✓ should bind Stripe accounts to req
    StripeAccounts#GET
      ✓ should have row for each Stripe account

  /account/connect/submit-company-registration
    SubmitCompanyRegistration#BEFORE
      ✓ should reject invalid stripeid
      ✓ should reject individual registration
      ✓ should bind Stripe account to req
    SubmitCompanyRegistration#GET
      4) should present the form
      ✓ should reject registration that hasn't submitted payment details
    SubmitCompanyRegistration#POST
      5) should submit registration

  /account/connect/submit-individual-registration
    SubmitIndividualRegistration#BEFORE
      ✓ should reject invalid stripeid
      ✓ should reject company registration
      ✓ should bind Stripe account to req
    SubmitIndividualRegistration#GET
      ✓ should present the form
      ✓ should reject registration that hasn't submitted payment details
    SubmitIndividualRegistration#POST
      ✓ should submit registration

  /administrator/connect/delete-stripe-account
    DeleteStripeAccount#BEFORE
      ✓ should bind Stripe account to req
    DeleteStripeAccount#GET
      ✓ should present the form
      ✓ should present the Stripe account table
    DeleteStripeAccount#POST
      ✓ should delete Stripe account

  /administrator/connect
    Index#BEFORE
      ✓ should bind Stripe accounts to req
    Index#GET
      ✓ should have row for each Stripe account

  /administrator/connect/payout
    Payout#BEFORE
      ✓ should reject invalid payoutid
      ✓ should bind payout to req
    Payout#GET
      ✓ should have row for payout

  /administrator/connect/payouts
    Payouts#BEFORE
      ✓ should bind payouts to req
    Payouts#GET
      ✓ should have row for each payout

  /administrator/connect/reject-stripe-account
    RejectStripeAccount#BEFORE
      ✓ should bind Stripe account to req
    RejectStripeAccount#GET
      ✓ should present the form
      ✓ should present the Stripe account table
    RejectStripeAccount#POST
      ✓ should update the Stripe account as rejected

  /administrator/connect/stripe-account
    StripeAccount#BEFORE
      ✓ should reject invalid stripeid
      ✓ should bind Stripe account to req
    StripeAccount#GET
      ✓ should have row for Stripe account

  /administrator/connect/stripe-accounts
    StripeAccounts#BEFORE
      ✓ should bind Stripe accounts to req
    StripeAccounts#GET
      ✓ should have row for each Stripe account

  /api/administrator/connect/account-stripe-accounts-count
    AccountStripeAccountsCount#GET
      ✓ should count all Stripe accounts on account

  /api/administrator/connect/account-stripe-accounts
    AccountStripeAccounts#GET
      ✓ should limit Stripe accounts to one page
      ✓ should enforce page size
      ✓ should enforce specified offset
      ✓ should return all records

  /api/administrator/connect/delete-stripe-account
    DeleteStripeAccount#DELETE
      ✓ should reject invalid stripeid
      ✓ should delete Stripe account

  /api/administrator/connect/payout
    Payout#GET
      ✓ should reject invalid payoutid
      ✓ should return payout data

  /api/administrator/connect/payouts-count
    PayoutsCount#GET
      ✓ should count all payouts

  /api/administrator/connect/payouts
    Payouts#GET
      ✓ should return all payouts list

  /api/administrator/connect/set-stripe-account-rejected
    RejectStripeAccount#PATCH
      ✓ should reject invalid stripeid
      ✓ should reject invalid reason
      ✓ should update the Stripe account as rejected

  /api/administrator/connect/stripe-account-payouts-count
    StripeAccountPayoutsCount#GET
      ✓ should count all payouts on Stripe account

  /api/administrator/connect/stripe-account-payouts
    StripeAccountPayouts#GET
      ✓ should return all payouts on Stripe account

  /api/administrator/connect/stripe-account
    StripeAccount#GET
      ✓ should reject invalid stripeid
      ✓ should return Stripe account data

  /api/administrator/connect/stripe-accounts-count
    StripeAccountsCount#GET
      ✓ should count all Stripe accounts

  /api/administrator/connect/stripe-accounts
    StripeAccounts#GET
      ✓ should limit Stripe accounts to one page
      ✓ should enforce page size
      ✓ should enforce specified offset
      ✓ should return all records

  /api/user/connect/beneficial-owner
    BeneficialOwner#GET
      ✓ should reject invalid ownerid
      ✓ should reject other account's owner
      ✓ should return owner data

  /api/user/connect/beneficial-owners-count
    BeneficialOwnersCount#GET
      ✓ should reject invalid stripeid
      ✓ should reject individual account
      ✓ should reject other account's registration
      ✓ should return count of owners

  /api/user/connect/beneficial-owners
    BeneficialOwners#GET
      ✓ should reject invalid stripeid
      ✓ should reject individual account
      ✓ should reject other account's registration
      ✓ should return owners

  /api/user/connect/company-director
    CompanyDirector#GET
      ✓ should reject invalid directorid
      ✓ should reject other account's director
      ✓ should return director data

  /api/user/connect/company-directors-count
    CompanyDirectorsCount#GET
      ✓ should reject invalid stripeid
      ✓ should reject individual account
      ✓ should reject other account's registration
      ✓ should return count of directors

  /api/user/connect/company-directors
    CompanyDirectors#GET
      ✓ should reject invalid stripeid
      ✓ should reject individual account
      ✓ should reject other account's registration
      ✓ should return directors

  /api/user/connect/country-spec
    CountrySpec#GET
      ✓ should reject invalid country
      ✓ should return stripe countrySpec data

  /api/user/connect/country-specs
    CountrySpecs#GET
      ✓ should return stripe countrySpec list

  /api/user/connect/create-beneficial-owner
    CreateBeneficialOwner#POST
      ✓ should reject invalid stripeid
      ✓ should reject individual account
      ✓ should reject other account's Stripe account
      ✓ should reject submitted account
      ✓ should reject invalid fields
      ✓ should create beneficial owner

  /api/user/connect/create-company-director
    CreateBeneficialOwner#POST
      ✓ should reject invalid stripeid
      ✓ should reject individual account
      ✓ should reject other account's Stripe account
